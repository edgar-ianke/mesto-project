(()=>{"use strict";var e=document.querySelector("#author-name"),t=document.querySelector("#author-description"),n=document.querySelector("#create-name"),o=document.querySelector("#create-link"),r=document.querySelector("#pop-up-full-img"),c=r.querySelector(".full-img"),a=r.querySelector(".full-img__info"),i=document.querySelector("#pop-up-edit"),u=document.querySelector("#pop-up-create"),s=document.querySelector("#pop-up-avatar"),d=document.querySelector("#avatar-link");function l(e){e.classList.remove("pop-up_disabled")}function m(e){e.classList.add("pop-up_disabled")}function f(e,t,n){e.target.lastElementChild.textContent=t?"Сохранение...":n}var p=document.querySelector(".elements");function v(e){p.append(function(e){var t=document.querySelector("#element").content.querySelector(".elements__element").cloneNode(!0);t.querySelector(".elements__card").src=e.link,t.querySelector(".elements__name").textContent=e.name,t.querySelector(".elements__card").setAttribute("alt",e.name),t.id=e._id;var n=t.querySelector(".elements__like"),o=t.querySelector(".elements__urn");e.owner._id!==g._id&&o.remove();var i=t.querySelector(".elements__like-counter");i.textContent=e.likes.length,e.likes.some((function(e){return e._id===g._id}))&&n.classList.add("elements__like_active"),o.onclick=function(e){var n;t.remove(),n=e.target.parentNode.id,fetch("https://nomoreparties.co/v1/plus-cohort-25/cards/".concat(n),{method:"DELETE",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},n.addEventListener("click",(function(e){var t;n.classList.toggle("elements__like_active"),n.classList.contains("elements__like_active")?(t=e.target.parentNode.parentNode.parentNode.id,fetch("https://nomoreparties.co/v1/plus-cohort-25/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),i.textContent++):(i.textContent--,function(e){!function(e){fetch("https://nomoreparties.co/v1/plus-cohort-25/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e)}(e.target.parentNode.parentNode.parentNode.id))}));var u=t.querySelector(".elements__card");return u.addEventListener("click",(function(){c.src=u.src,a.textContent=t.lastElementChild.firstElementChild.textContent,c.setAttribute("alt",t.textContent.trim()),l(r)})),t}(e))}function _(){fetch("https://nomoreparties.co/v1/plus-cohort-25/cards",{headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach(v)}))}var h=document.querySelector(".profile__edit-button"),y=document.querySelector("#edit-close"),b=document.querySelector(".profile__avatar"),S=document.querySelector(".profile__add-button"),q=document.querySelector("#create-close"),C=document.querySelector("#img-close"),E=document.querySelector("#avatar-close"),k=document.querySelector(".profile__name"),L=document.querySelector(".profile__description"),g={};var j=document.querySelector("#edit-form"),x=document.querySelector("#create-form"),P=document.querySelector("#avatar-form");function T(e,t){var n=e.querySelector("#".concat(t.id,"-error"));t.classList.remove("form__input_error"),n.textContent=""}function N(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("form__submit-button_disabled"),t.disabled=!1):(t.classList.add("form__submit-button_disabled"),t.disabled=!0)}Array.from(document.querySelectorAll(".form")).forEach((function(e){return function(e){var t=Array.from(e.querySelectorAll(".form__input")),n=e.querySelector(".form__submit-button");N(t,n),t.forEach((function(o){return o.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity("Разрешены только латинские буквы, кириллические буквы, знаки дефиса и пробелы"):t.setCustomValidity(""),t.validity.valid?T(e,t):function(e,t,n){var o=e.querySelector("#".concat(t.id,"-error"));t.classList.add("form__input_error"),o.textContent=n}(e,t,t.validationMessage)}(e,o),N(t,n)}))}))}(e)})),h.addEventListener("click",(function(){e.value=k.textContent,t.value=L.textContent,T(j,e),T(j,t);var n=i.querySelector(".form__submit-button");n.classList.add("form__submit-button_disabled"),n.disabled=!0,l(i)})),y.addEventListener("click",(function(e){m(i)})),S.addEventListener("click",(function(e){n.value="",o.value="",T(x,n),T(x,o);var t=u.querySelector(".form__submit-button");t.classList.add("form__submit-button_disabled"),t.disabled=!0,l(u)})),q.addEventListener("click",(function(e){m(u)})),x.addEventListener("submit",(function(e){e.preventDefault(),function(e){var t=e.target.lastElementChild.textContent;f(e,!0,t),fetch("https://nomoreparties.co/v1/plus-cohort-25/cards",{method:"POST",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"},body:JSON.stringify({name:n.value,link:o.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(){p.innerHTML="",_()})).finally((function(){m(u),f(e,!1,t)}))}(e)})),C.addEventListener("click",(function(){return m(r)})),i.addEventListener("mousedown",(function(e){"pop-up-edit"===e.target.id&&m(i)})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&(m(i),m(u),m(r),m(s))})),u.addEventListener("mousedown",(function(e){"pop-up-create"===e.target.id&&m(u)})),r.addEventListener("mousedown",(function(e){"pop-up-full-img"===e.target.id&&m(r)})),s.addEventListener("mousedown",(function(e){"pop-up-avatar"===e.target.id&&m(s)})),j.addEventListener("submit",(function(n){n.preventDefault(),function(n){var o=n.target.lastElementChild.textContent;f(n,!0,o),fetch("https://nomoreparties.co/v1/plus-cohort-25/users/me",{method:"PATCH",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"},body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){k.textContent=e.name,L.textContent=e.about})).finally((function(){m(i),f(n,!1,o)}))}(n)})),fetch("https://nomoreparties.co/v1/plus-cohort-25/users/me",{headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(n){g=Object.assign({},n),k.textContent=n.name,L.textContent=n.about,e.value=n.name,t.value=n.about,b.src=n.avatar,_()})),b.addEventListener("click",(function(){d.value="",T(P,d);var e=s.querySelector(".form__submit-button");e.classList.add("form__submit-button_disabled"),e.disabled=!0,l(s)})),E.addEventListener("click",(function(e){m(s)})),P.addEventListener("submit",(function(e){e.preventDefault(),function(e){var t=e.target.lastElementChild.textContent;f(e,!0,t),fetch("https://nomoreparties.co/v1/plus-cohort-25/users/me/avatar",{method:"PATCH",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"},body:JSON.stringify({avatar:d.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){b.src=e.avatar})).finally((function(){m(s),f(e,!1,t)}))}(e),b.src=d.value}))})();