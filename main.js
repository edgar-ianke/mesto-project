(()=>{"use strict";var e=document.querySelector("#author-name"),t=document.querySelector("#author-description"),n=document.querySelector("#create-name"),o=document.querySelector("#create-link"),r=document.querySelector("#pop-up-full-img"),i=r.querySelector(".full-img"),c=r.querySelector(".full-img__info"),a=document.querySelector("#pop-up-edit"),u=document.querySelector("#pop-up-create"),s=document.querySelector("#pop-up-avatar"),l=document.querySelector("#avatar-link");function d(e){e.classList.remove("pop-up_disabled"),document.addEventListener("keydown",m)}function m(e){"Escape"===e.key&&f(Array.from(document.querySelectorAll(".pop-up")).find((function(e){return!e.classList.contains("pop-up_disabled")})))}function f(e){e.classList.add("pop-up_disabled"),document.removeEventListener("keydown",m)}function p(e,t,n){e.target.lastElementChild.textContent=t?"Сохранение...":n}var v=document.querySelector(".elements");function h(e){v.append(function(e){var t=document.querySelector("#element").content.querySelector(".elements__element").cloneNode(!0);t.querySelector(".elements__card").src=e.link,t.querySelector(".elements__name").textContent=e.name,t.querySelector(".elements__card").setAttribute("alt",e.name),t.id=e._id;var n=t.querySelector(".elements__like"),o=t.querySelector(".elements__urn");e.owner._id!==j._id&&o.remove();var a=t.querySelector(".elements__like-counter");a.textContent=e.likes.length,e.likes.some((function(e){return e._id===j._id}))&&n.classList.add("elements__like_active"),o.onclick=function(e){var n;t.remove(),n=e.target.parentNode.id,fetch("https://nomoreparties.co/v1/plus-cohort-25/cards/".concat(n),{method:"DELETE",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},n.addEventListener("click",(function(e){var t;n.classList.toggle("elements__like_active"),n.classList.contains("elements__like_active")?(t=e.target.parentNode.parentNode.parentNode.id,fetch("https://nomoreparties.co/v1/plus-cohort-25/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),a.textContent++):(a.textContent--,function(e){!function(e){fetch("https://nomoreparties.co/v1/plus-cohort-25/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e)}(e.target.parentNode.parentNode.parentNode.id))}));var u=t.querySelector(".elements__card");return u.addEventListener("click",(function(){i.src=u.src,c.textContent=t.lastElementChild.firstElementChild.textContent,i.setAttribute("alt",t.textContent.trim()),d(r)})),t}(e))}function _(){fetch("https://nomoreparties.co/v1/plus-cohort-25/cards",{headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach(h)}))}var y=document.querySelector(".profile__edit-button"),b=document.querySelector("#edit-close"),E=document.querySelector(".profile__avatar"),C=document.querySelector(".profile__add-button"),S=document.querySelector("#create-close"),q=document.querySelector("#img-close"),k=document.querySelector("#avatar-close"),L=document.querySelector(".profile__name"),g=document.querySelector(".profile__description"),j={};var x,A,P,T,N,z,w=document.querySelector("#edit-form"),D=document.querySelector("#create-form"),O=document.querySelector("#avatar-form");function B(e,t,n){var o=t.nextElementSibling;t.classList.remove(n),o.textContent=""}function H(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):J(t,n)}function J(e,t){e.classList.add(t),e.disabled=!0}A=(x={formElementsAll:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_disabled",inputErrorClass:"form__input_error"}).formElementsAll,P=x.inputSelector,T=x.submitButtonSelector,N=x.inactiveButtonClass,z=x.inputErrorClass,Array.from(document.querySelectorAll(A)).forEach((function(e){return function(e,t,n,o,r){var i=Array.from(e.querySelectorAll(t)),c=e.querySelector(n);H(i,c,o),i.forEach((function(e){return e.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity("Разрешены только латинские буквы, кириллические буквы, знаки дефиса и пробелы"):t.setCustomValidity(""),t.validity.valid?B(0,t,n):function(e,t,n,o){var r=t.nextElementSibling;t.classList.add(o),r.textContent=n}(0,t,t.validationMessage,n)}(0,e,r),H(i,c,o)}))}))}(e,P,T,N,z)})),y.addEventListener("click",(function(){e.value=L.textContent,t.value=g.textContent,B(0,e,"form__input_error"),B(0,t,"form__input_error"),J(a.firstElementChild.firstElementChild.lastElementChild,"form__submit-button_disabled"),d(a)})),b.addEventListener("click",(function(e){f(a)})),C.addEventListener("click",(function(e){n.value="",o.value="",B(0,n,"form__input_error"),B(0,o,"form__input_error"),J(u.firstElementChild.firstElementChild.lastElementChild,"form__submit-button_disabled"),d(u)})),S.addEventListener("click",(function(e){f(u)})),D.addEventListener("submit",(function(e){e.preventDefault(),function(e){var t=e.target.lastElementChild.textContent;p(e,!0,t),fetch("https://nomoreparties.co/v1/plus-cohort-25/cards",{method:"POST",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"},body:JSON.stringify({name:n.value,link:o.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(){v.innerHTML="",_()})).finally((function(){f(u),p(e,!1,t)}))}(e)})),q.addEventListener("click",(function(){return f(r)})),a.addEventListener("mousedown",(function(e){"pop-up-edit"===e.target.id&&f(a)})),u.addEventListener("mousedown",(function(e){"pop-up-create"===e.target.id&&f(u)})),r.addEventListener("mousedown",(function(e){"pop-up-full-img"===e.target.id&&f(r)})),s.addEventListener("mousedown",(function(e){"pop-up-avatar"===e.target.id&&f(s)})),w.addEventListener("submit",(function(n){n.preventDefault(),function(n){var o=n.target.lastElementChild.textContent;p(n,!0,o),fetch("https://nomoreparties.co/v1/plus-cohort-25/users/me",{method:"PATCH",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"},body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){L.textContent=e.name,g.textContent=e.about})).finally((function(){f(a),p(n,!1,o)}))}(n)})),fetch("https://nomoreparties.co/v1/plus-cohort-25/users/me",{headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(n){j=Object.assign({},n),L.textContent=n.name,g.textContent=n.about,e.value=n.name,t.value=n.about,E.src=n.avatar,_()})),E.addEventListener("click",(function(){l.value="",B(0,l),J(s.firstElementChild.firstElementChild.lastElementChild,"form__submit-button_disabled"),d(s)})),k.addEventListener("click",(function(e){f(s)})),O.addEventListener("submit",(function(e){e.preventDefault(),function(e){var t=e.target.lastElementChild.textContent;p(e,!0,t),fetch("https://nomoreparties.co/v1/plus-cohort-25/users/me/avatar",{method:"PATCH",headers:{authorization:"02ffe6ee-1e50-4771-9330-975ddbfb736c","Content-Type":"application/json"},body:JSON.stringify({avatar:l.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){E.src=e.avatar})).finally((function(){f(s),p(e,!1,t)}))}(e),E.src=l.value}))})();